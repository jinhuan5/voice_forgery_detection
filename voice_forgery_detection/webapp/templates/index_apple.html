<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯­éŸ³ä¼ªé€ æ£€æµ‹ - Appleé£æ ¼</title>
    <style>
        /* Appleè®¾è®¡ç³»ç»Ÿå˜é‡ */
        :root {
            /* é¢œè‰²ç³»ç»Ÿ - Appleé£æ ¼ */
            --apple-blue: #007AFF;
            --apple-blue-dark: #0051D5;
            --apple-gray-100: #F2F2F7;
            --apple-gray-200: #E5E5EA;
            --apple-gray-300: #D1D1D6;
            --apple-gray-400: #C7C7CC;
            --apple-gray-500: #AEAEB2;
            --apple-gray-600: #8E8E93;
            --apple-gray-700: #636366;
            --apple-gray-800: #48484A;
            --apple-gray-900: #1C1C1E;
            --apple-white: #FFFFFF;
            --apple-black: #000000;
            --apple-green: #34C759;
            --apple-red: #FF3B30;
            --apple-orange: #FF9500;
            --apple-yellow: #FFCC00;

            /* é—´è·ç³»ç»Ÿ */
            --apple-space-xs: 4px;
            --apple-space-sm: 8px;
            --apple-space-md: 16px;
            --apple-space-lg: 24px;
            --apple-space-xl: 32px;
            --apple-space-2xl: 48px;
            --apple-space-3xl: 64px;

            /* å­—ä½“ç³»ç»Ÿ */
            --apple-font-system: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Icons', 'Helvetica Neue', 'Helvetica', 'Arial', sans-serif;
            --apple-font-size-xs: 12px;
            --apple-font-size-sm: 14px;
            --apple-font-size-md: 16px;
            --apple-font-size-lg: 20px;
            --apple-font-size-xl: 24px;
            --apple-font-size-2xl: 32px;
            --apple-font-size-3xl: 48px;

            /* åœ†è§’ç³»ç»Ÿ */
            --apple-radius-sm: 8px;
            --apple-radius-md: 12px;
            --apple-radius-lg: 16px;
            --apple-radius-xl: 20px;
            --apple-radius-2xl: 24px;

            /* é˜´å½±ç³»ç»Ÿ */
            --apple-shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.08);
            --apple-shadow-md: 0 4px 16px rgba(0, 0, 0, 0.12);
            --apple-shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.16);

            /* åŠ¨ç”» */
            --apple-transition-fast: 0.2s ease;
            --apple-transition-normal: 0.3s ease;
            --apple-transition-slow: 0.5s ease;
        }

        /* å…¨å±€æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--apple-font-system);
            font-size: var(--apple-font-size-md);
            line-height: 1.5;
            color: var(--apple-gray-900);
            background: linear-gradient(135deg, #F5F7FF 0%, #E6EAFF 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--apple-space-lg);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* ä¸»å®¹å™¨ - Appleé£æ ¼ */
        .apple-container {
            background: var(--apple-white);
            border-radius: var(--apple-radius-2xl);
            box-shadow: var(--apple-shadow-lg);
            padding: var(--apple-space-3xl);
            max-width: 800px;
            width: 100%;
            text-align: center;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* æ ‡é¢˜åŒºåŸŸ */
        .apple-header {
            margin-bottom: var(--apple-space-3xl);
            position: relative;
        }

        .apple-title {
            font-size: var(--apple-font-size-3xl);
            font-weight: 700;
            color: var(--apple-gray-900);
            margin-bottom: var(--apple-space-md);
            line-height: 1.1;
        }

        .apple-subtitle {
            font-size: var(--apple-font-size-lg);
            color: var(--apple-gray-600);
            font-weight: 400;
            margin-bottom: var(--apple-space-sm);
        }

        .apple-description {
            font-size: var(--apple-font-size-sm);
            color: var(--apple-gray-500);
            margin-bottom: var(--apple-space-lg);
        }

        /* ä¸Šä¼ åŒºåŸŸ - Appleé£æ ¼ */
        .apple-upload-card {
            background: var(--apple-gray-100);
            border: 2px dashed var(--apple-gray-300);
            border-radius: var(--apple-radius-xl);
            padding: var(--apple-space-3xl);
            margin: var(--apple-space-2xl) 0;
            transition: all var(--apple-transition-fast);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .apple-upload-card:hover {
            border-color: var(--apple-blue);
            background: rgba(0, 122, 255, 0.05);
            transform: translateY(-2px);
            box-shadow: var(--apple-shadow-md);
        }

        .apple-upload-card.dragover {
            border-color: var(--apple-blue);
            background: rgba(0, 122, 255, 0.1);
            transform: scale(1.01);
        }

        .apple-upload-icon {
            font-size: 64px;
            color: var(--apple-blue);
            margin-bottom: var(--apple-space-lg);
            display: block;
        }

        .apple-upload-text {
            font-size: var(--apple-font-size-lg);
            color: var(--apple-gray-700);
            margin-bottom: var(--apple-space-md);
            font-weight: 600;
        }

        .apple-upload-hint {
            font-size: var(--apple-font-size-sm);
            color: var(--apple-gray-500);
            margin-bottom: var(--apple-space-lg);
        }

        /* Appleé£æ ¼æŒ‰é’® */
        .apple-btn {
            background: var(--apple-blue);
            color: var(--apple-white);
            border: none;
            padding: var(--apple-space-md) var(--apple-space-xl);
            border-radius: var(--apple-radius-md);
            font-size: var(--apple-font-size-md);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--apple-transition-fast);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--apple-space-sm);
            min-height: 44px;
            font-family: var(--apple-font-system);
        }

        .apple-btn:hover {
            background: var(--apple-blue-dark);
            transform: translateY(-1px);
            box-shadow: var(--apple-shadow-sm);
        }

        .apple-btn:active {
            transform: translateY(0);
        }

        .apple-btn:disabled {
            background: var(--apple-gray-300);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Appleé£æ ¼è¾“å…¥æ¡† */
        .apple-file-input {
            display: none;
        }

        /* æ–‡ä»¶ä¿¡æ¯å¡ç‰‡ */
        .apple-file-card {
            background: var(--apple-gray-100);
            border-radius: var(--apple-radius-lg);
            padding: var(--apple-space-lg);
            margin: var(--apple-space-lg) 0;
            border-left: 4px solid var(--apple-blue);
            text-align: left;
        }

        .apple-file-info {
            font-size: var(--apple-font-size-sm);
            color: var(--apple-gray-700);
            margin-bottom: var(--apple-space-xs);
        }

        .apple-file-info:last-child {
            margin-bottom: 0;
        }

        /* Appleé£æ ¼åŠ è½½åŠ¨ç”» */
        .apple-loading {
            display: none;
            margin: var(--apple-space-2xl) 0;
            text-align: center;
        }

        .apple-loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--apple-gray-200);
            border-top: 3px solid var(--apple-blue);
            border-radius: 50%;
            animation: apple-spin 1s linear infinite;
            margin: 0 auto var(--apple-space-md);
        }

        @keyframes apple-spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .apple-loading-text {
            font-size: var(--apple-font-size-md);
            color: var(--apple-gray-600);
        }

        /* Appleé£æ ¼ç»“æœåŒºåŸŸ */
        .apple-result-card {
            margin-top: var(--apple-space-2xl);
            padding: var(--apple-space-xl);
            border-radius: var(--apple-radius-xl);
            display: none;
            text-align: left;
            backdrop-filter: blur(10px);
        }

        .apple-result-real {
            background: linear-gradient(135deg, var(--apple-green), #30A14E);
            color: var(--apple-white);
        }

        .apple-result-fake {
            background: linear-gradient(135deg, var(--apple-red), #D70015);
            color: var(--apple-white);
        }

        .apple-result-error {
            background: linear-gradient(135deg, var(--apple-orange), #CC4E00);
            color: var(--apple-white);
        }

        .apple-result-title {
            font-size: var(--apple-font-size-xl);
            font-weight: 700;
            margin-bottom: var(--apple-space-md);
            display: flex;
            align-items: center;
            gap: var(--apple-space-sm);
        }

        .apple-result-details {
            font-size: var(--apple-font-size-md);
            margin: var(--apple-space-sm) 0;
            opacity: 0.95;
        }

        /* Appleé£æ ¼ç½®ä¿¡åº¦æ¡ */
        .apple-confidence-bar {
            background: rgba(255, 255, 255, 0.3);
            border-radius: var(--apple-radius-sm);
            height: 8px;
            margin: var(--apple-space-lg) 0;
            overflow: hidden;
        }

        .apple-confidence-fill {
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            border-radius: var(--apple-radius-sm);
            transition: width var(--apple-transition-slow);
        }

        /* Appleé£æ ¼é¢‘è°±å›¾ */
        .apple-spectrogram {
            margin-top: var(--apple-space-xl);
            text-align: center;
        }

        .apple-spectrogram-title {
            font-size: var(--apple-font-size-lg);
            font-weight: 600;
            color: var(--apple-white);
            margin-bottom: var(--apple-space-md);
            opacity: 0.9;
        }

        .apple-spectrogram img {
            max-width: 100%;
            border-radius: var(--apple-radius-lg);
            box-shadow: var(--apple-shadow-md);
        }

        /* Appleé£æ ¼æ”¯æŒæ ¼å¼ */
        .apple-info-section {
            margin-top: var(--apple-space-2xl);
            padding-top: var(--apple-space-xl);
            border-top: 1px solid var(--apple-gray-200);
        }

        .apple-info-title {
            font-size: var(--apple-font-size-sm);
            font-weight: 600;
            color: var(--apple-gray-700);
            margin-bottom: var(--apple-space-sm);
        }

        .apple-info-text {
            font-size: var(--apple-font-size-xs);
            color: var(--apple-gray-500);
            line-height: 1.6;
        }

        /* Appleé£æ ¼é¡µè„š */
        .apple-footer {
            margin-top: var(--apple-space-2xl);
            padding-top: var(--apple-space-xl);
            border-top: 1px solid var(--apple-gray-200);
            text-align: center;
        }

        .apple-footer-text {
            font-size: var(--apple-font-size-xs);
            color: var(--apple-gray-500);
            margin-bottom: var(--apple-space-xs);
        }

        .apple-footer-text:last-child {
            margin-bottom: 0;
        }

        /* é£æ ¼åˆ‡æ¢æŒ‰é’® */
        .apple-style-switch {
            position: absolute;
            top: var(--apple-space-lg);
            right: var(--apple-space-lg);
            background: var(--apple-gray-100);
            color: var(--apple-gray-700);
            border: 1px solid var(--apple-gray-300);
            padding: var(--apple-space-sm) var(--apple-space-md);
            border-radius: var(--apple-radius-md);
            font-size: var(--apple-font-size-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--apple-transition-fast);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: var(--apple-space-sm);
        }

        .apple-style-switch:hover {
            background: var(--apple-gray-200);
            border-color: var(--apple-gray-400);
            transform: translateY(-1px);
        }

        .apple-footer-text {
            font-size: var(--apple-font-size-xs);
            color: var(--apple-gray-500);
            margin-bottom: var(--apple-space-xs);
        }

        .apple-footer-text:last-child {
            margin-bottom: 0;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            body {
                padding: var(--apple-space-md);
            }

            .apple-container {
                padding: var(--apple-space-xl);
                margin: var(--apple-space-sm);
            }

            .apple-title {
                font-size: var(--apple-font-size-2xl);
            }

            .apple-upload-card {
                padding: var(--apple-space-xl);
            }

            .apple-upload-icon {
                font-size: 48px;
            }
        }

        @media (max-width: 480px) {
            .apple-container {
                padding: var(--apple-space-lg);
            }

            .apple-title {
                font-size: var(--apple-font-size-xl);
            }

            .apple-upload-card {
                padding: var(--apple-space-lg);
            }

            .apple-upload-icon {
                font-size: 40px;
            }
        }
    </style>
</head>
<body>
    <div class="apple-container">
        <a href="/" class="apple-style-switch">è¿”å›åŸç‰ˆ</a>
        <div class="apple-header">
            <h1 class="apple-title">è¯­éŸ³ä¼ªé€ æ£€æµ‹</h1>
            <p class="apple-subtitle">AIæ™ºèƒ½è¯†åˆ«éŸ³é¢‘çœŸä¼ª</p>
            <p class="apple-description">ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶ï¼Œå¿«é€Ÿæ£€æµ‹æ˜¯å¦ä¸ºä¼ªé€ è¯­éŸ³</p>
        </div>

        <div class="apple-upload-card" id="uploadArea">
            <div class="apple-upload-icon">ğŸµ</div>
            <div class="apple-upload-text">é€‰æ‹©éŸ³é¢‘æ–‡ä»¶æˆ–æ‹–æ‹½åˆ°æ­¤å¤„</div>
            <div class="apple-upload-hint">æ”¯æŒ WAVã€MP3ã€M4Aã€FLAC æ ¼å¼</div>
            <input type="file" id="fileInput" class="apple-file-input" accept=".wav,.mp3,.m4a,.flac">
            <button class="apple-btn" onclick="document.getElementById('fileInput').click()">
                é€‰æ‹©æ–‡ä»¶
            </button>
        </div>

        <div class="apple-file-card" id="fileInfo" style="display: none;">
            <div class="apple-file-info" id="fileName"></div>
            <div class="apple-file-info" id="fileSize"></div>
        </div>

        <div class="apple-loading" id="loading">
            <div class="apple-loading-spinner"></div>
            <div class="apple-loading-text">æ­£åœ¨åˆ†æéŸ³é¢‘...</div>
        </div>

        <div class="apple-result-card" id="resultArea">
            <div class="apple-result-title" id="resultTitle"></div>
            <div class="apple-result-details" id="resultDetails"></div>
            <div class="apple-confidence-bar">
                <div class="apple-confidence-fill" id="confidenceFill"></div>
            </div>
            <div class="apple-spectrogram" id="spectrogram"></div>
        </div>

        <div class="apple-info-section">
            <div class="apple-info-title">æ”¯æŒçš„æ ¼å¼</div>
            <div class="apple-info-text">
                WAV, MP3, M4A, FLAC<br>
                æ–‡ä»¶å¤§å°é™åˆ¶ï¼š16MBä»¥å†…
            </div>
        </div>

        <div class="apple-footer">
            <div class="apple-footer-text">ğŸ”¬ åŸºäºæœºå™¨å­¦ä¹ çš„è¯­éŸ³ä¼ªé€ æ£€æµ‹æŠ€æœ¯</div>
            <div class="apple-footer-text">ä½¿ç”¨MFCCç‰¹å¾å’Œå¤šç§æœºå™¨å­¦ä¹ ç®—æ³•è¿›è¡Œæ™ºèƒ½è¯†åˆ«</div>
        </div>
    </div>

    <script>
        // Appleé£æ ¼çš„JavaScriptäº¤äº’
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const fileInfo = document.getElementById('fileInfo');
        const loading = document.getElementById('loading');
        const resultArea = document.getElementById('resultArea');
        const resultTitle = document.getElementById('resultTitle');
        const resultDetails = document.getElementById('resultDetails');
        const confidenceFill = document.getElementById('confidenceFill');
        const spectrogram = document.getElementById('spectrogram');

        // æ–‡ä»¶æ‹–æ‹½åŠŸèƒ½
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        // æ–‡ä»¶é€‰æ‹©
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        function handleFile(file) {
            // æ£€æŸ¥æ–‡ä»¶ç±»å‹
            const allowedTypes = ['audio/wav', 'audio/mpeg', 'audio/mp4', 'audio/flac'];
            const fileExtension = file.name.split('.').pop().toLowerCase();
            const allowedExtensions = ['wav', 'mp3', 'm4a', 'flac'];

            if (!allowedTypes.includes(file.type) && !allowedExtensions.includes(fileExtension)) {
                alert('ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ï¼è¯·é€‰æ‹©WAVã€MP3ã€M4Aæˆ–FLACæ–‡ä»¶ã€‚');
                return;
            }

            // æ£€æŸ¥æ–‡ä»¶å¤§å°
            if (file.size > 16 * 1024 * 1024) {
                alert('æ–‡ä»¶è¿‡å¤§ï¼è¯·é€‰æ‹©å°äº16MBçš„æ–‡ä»¶ã€‚');
                return;
            }

            // æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
            document.getElementById('fileName').textContent = `æ–‡ä»¶å: ${file.name}`;
            document.getElementById('fileSize').textContent = `æ–‡ä»¶å¤§å°: ${(file.size / 1024 / 1024).toFixed(2)} MB`;
            fileInfo.style.display = 'block';

            // ä¸Šä¼ æ–‡ä»¶
            uploadFile(file);
        }

        function uploadFile(file) {
            const formData = new FormData();
            formData.append('file', file);

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            loading.style.display = 'block';
            resultArea.style.display = 'none';

            fetch('/upload', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                loading.style.display = 'none';

                if (data.success) {
                    displayResult(data.result, data.spectrogram);
                } else {
                    displayError(data.error);
                }
            })
            .catch(error => {
                loading.style.display = 'none';
                displayError('ä¸Šä¼ å¤±è´¥: ' + error.message);
            });
        }

        function displayResult(result, spectrogramData) {
            resultArea.style.display = 'block';

            if (result.error) {
                displayError(result.error);
                return;
            }

            const isFake = result.is_fake;
            const confidence = result.confidence;
            const probReal = result.real_probability;
            const probFake = result.fake_probability;

            // è®¾ç½®ç»“æœæ ·å¼å’Œå†…å®¹
            resultArea.className = 'apple-result-card ' + (isFake ? 'apple-result-fake' : 'apple-result-real');

            resultTitle.innerHTML = isFake ?
                '<span>âš ï¸</span>æ£€æµ‹åˆ°ä¼ªé€ è¯­éŸ³' :
                '<span>âœ“</span>çœŸå®è¯­éŸ³';

            resultDetails.innerHTML = `
                <div>çœŸå®æ¦‚ç‡: ${(probReal * 100).toFixed(1)}%</div>
                <div>ä¼ªé€ æ¦‚ç‡: ${(probFake * 100).toFixed(1)}%</div>
            `;

            // è®¾ç½®ç½®ä¿¡åº¦æ¡
            confidenceFill.style.width = (confidence * 100) + '%';

            // æ˜¾ç¤ºé¢‘è°±å›¾
            if (spectrogramData) {
                spectrogram.innerHTML = `
                    <div class="apple-spectrogram-title">éŸ³é¢‘é¢‘è°±åˆ†æ</div>
                    <img src="data:image/png;base64,${spectrogramData}" alt="é¢‘è°±å›¾">
                `;
            }
        }

        function displayError(error) {
            resultArea.style.display = 'block';
            resultArea.className = 'apple-result-card apple-result-error';
            resultTitle.innerHTML = '<span>âœ—</span>æ£€æµ‹å¤±è´¥';
            resultDetails.textContent = error;
            confidenceFill.style.width = '0%';
            spectrogram.innerHTML = '';
        }
    </script>
</body>
</html>